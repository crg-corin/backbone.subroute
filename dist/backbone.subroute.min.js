!function(a){"function"==typeof define&&define.amd?define(["underscore","backbone"],a):"object"==typeof exports?module.exports=a(require("underscore"),require("backbone")):a(_,Backbone)}(function(a,b){return b.History.prototype.route=function(a,b,c){this.handlers.unshift({route:a,callback:b,router:c})},b.SubRoute=b.Router.extend({constructor:function(c,d){this.routes=a.clone(this.routes)||{},this.prefix=c=c||"",this.separator="/"===c.slice(-1)?"":"/",this.createTrailingSlashRoutes=d&&d.createTrailingSlashRoutes,b.Router.prototype.constructor.call(this,d);var e;e=b.history.fragment?b.history.getFragment():b.history.getHash(),a.every(this.routes,function(a,c){return e.match(b.Router.prototype._routeToRegExp(c))?(b.history.loadUrl(e),!1):!0},this),this.postInitialize&&this.postInitialize(d)},navigate:function(a,c){"/"!=a.substr(0,1)&&0!==a.indexOf(this.prefix.substr(0,this.prefix.length-1))&&(a=this.prefix+(a?this.separator:"")+a),b.Router.prototype.navigate.call(this,a,c)},route:function(c,d,e){"/"===c.substr(0)&&(c=c.substr(1,c.length));var f=this.prefix;c&&c.length>0&&(this.prefix.length>0&&(f+=this.separator),f+=c),this.createTrailingSlashRoutes&&(this.routes[f+"/"]=d,b.Router.prototype.route.call(this,f+"/",d,e)),delete this.routes[c],this.routes[f]=d,a.isRegExp(f)||(f=this._routeToRegExp(f)),a.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var g=this;return b.history.route(f,function(a){var c=g._extractParameters(f,a);g.execute(e,c),g.trigger.apply(g,["route:"+d].concat(c)),g.trigger("route",d,c),b.history.trigger("route",g,d,c)},this),this},remove:function(){this.off(),this.stopListening(),b.history.handlers=a.reject(b.history.handlers,function(a){return a.router===this},this)}}),b.SubRoute});